var st=Object.defineProperty;var z=i=>{throw TypeError(i)};var nt=(i,t,e)=>t in i?st(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var o=(i,t,e)=>nt(i,typeof t!="symbol"?t+"":t,e),F=(i,t,e)=>t.has(i)||z("Cannot "+e);var r=(i,t,e)=>(F(i,t,"read from private field"),e?e.call(i):t.get(i)),a=(i,t,e)=>t.has(i)?z("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(i):t.set(i,e),d=(i,t,e,s)=>(F(i,t,"write to private field"),s?s.call(i,e):t.set(i,e),e),l=(i,t,e)=>(F(i,t,"access private method"),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const h of n)if(h.type==="childList")for(const A of h.addedNodes)A.tagName==="LINK"&&A.rel==="modulepreload"&&s(A)}).observe(document,{childList:!0,subtree:!0});function e(n){const h={};return n.integrity&&(h.integrity=n.integrity),n.referrerPolicy&&(h.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?h.credentials="include":n.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function s(n){if(n.ep)return;n.ep=!0;const h=e(n);fetch(n.href,h)}})();var c;class rt{constructor(){a(this,c,{})}on(t,e){var s;return(s=r(this,c))[t]??(s[t]=[]),r(this,c)[t].push(e),this}off(t,e){const s=r(this,c)[t];return r(this,c)[t]=e?s==null?void 0:s.filter(n=>n!==e):[],this}emit(t,...e){var s;return(s=r(this,c)[t])==null||s.forEach(n=>setTimeout(()=>n(...e))),this}destroy(){return d(this,c,{}),this}}c=new WeakMap;Math.TAU??(Math.TAU=2*Math.PI);window.eventBus=new rt;function v(i,t,e){i.fillStyle="green",i.fillRect(t-2/2,e-2/2,2,2)}function V(i,t,e){return i+(t-i)*e}function I(i,t,e){return Math.max(t,Math.min(i,e))}function H(i,t){return Math.hypot(i.x-t.x,i.y-t.y)}function ot(i,t){return i+Math.sign(i)*t}function ht(i,t){return{x:i*Math.cos(t),y:i*Math.sin(t)}}function at(i,t,e){return i*e/(e-t)}const ct=5;class dt{constructor(t,e,s,n,h){o(this,"x");o(this,"width");o(this,"length");o(this,"laneCount");o(this,"margin");o(this,"left");o(this,"right");o(this,"top");o(this,"bottom");this.x=t,this.width=e,this.length=s,this.laneCount=n,this.margin=h,this.left=t-e/2+h,this.right=t+e/2-h,this.top=-s/2,this.bottom=s/2}update(){}getLaneCenter(t){const e=this.width/this.laneCount;return V(this.left,this.right,t/this.laneCount)+e/2}draw(t){t.save(),t.lineWidth=ct,t.strokeStyle="White";for(let e=0;e<=this.laneCount;e++){const s=[0,this.laneCount].includes(e);t.setLineDash(s?[]:[30,60]);const n=V(this.left,this.right,e/this.laneCount);t.beginPath(),t.moveTo(n,this.top),t.lineTo(n,this.bottom),t.stroke(),v(t,n,0)}t.restore()}}var P,J;class lt{constructor(){a(this,P);o(this,"up",!1);o(this,"down",!1);o(this,"left",!1);o(this,"right",!1);l(this,P,J).call(this)}}P=new WeakSet,J=function(){document.addEventListener("keydown",t=>{switch(t.key){case"ArrowUp":this.up=!0;break;case"ArrowDown":this.down=!0;break;case"ArrowLeft":this.left=!0;break;case"ArrowRight":this.right=!0;break}}),document.addEventListener("keyup",t=>{switch(t.key){case"ArrowUp":this.up=!1;break;case"ArrowDown":this.down=!1;break;case"ArrowLeft":this.left=!1;break;case"ArrowRight":this.right=!1;break}})};const q=3.7,K=.17,N=.03,j=.05;var y,f,g,Q,X,Y;class ut{constructor(t,e,s,n,h){a(this,g);o(this,"x");o(this,"y");o(this,"width");o(this,"length");o(this,"direction",-Math.TAU/4);o(this,"speed",0);a(this,y);a(this,f);this.x=t,this.y=e,this.width=s,this.length=n,d(this,f,new lt),h&&(d(this,y,new Image),r(this,y).src=h)}update(){l(this,g,Q).call(this),l(this,g,X).call(this),l(this,g,Y).call(this)}draw(t){t.save(),t.translate(this.x,this.y),t.rotate(this.direction),r(this,y)?t.drawImage(r(this,y),-this.length/2,-this.width/2,this.length,this.width):(t.fillStyle="black",t.fillRect(-this.length/2,-this.width/2,this.length*(1-.17),this.width),t.fillStyle="red",t.fillRect(-this.length/2+this.length*(1-.17),-this.width/2,.17*this.length,this.width)),v(t,0,0),v(t,-this.length/2,-this.width/2),v(t,-this.length/2,this.width/2),v(t,this.length/2,-this.width/2),v(t,this.length/2,this.width/2),t.restore()}}y=new WeakMap,f=new WeakMap,g=new WeakSet,Q=function(){r(this,f).up&&(this.speed=I(this.speed+K,-q,q)),r(this,f).down&&(this.speed=I(this.speed-K,-q,q)),this.speed=ot(this.speed,-j),Math.abs(this.speed)<j&&(this.speed=0)},X=function(){r(this,f).left&&(this.direction-=Math.sign(this.speed)*N),r(this,f).right&&(this.direction+=Math.sign(this.speed)*N)},Y=function(){const{x:t,y:e}=ht(this.speed,this.direction);this.x+=t,this.y+=e};const u=new AudioContext,ft=.1;var m,p;class pt{constructor(t){o(this,"duration");a(this,m,new OscillatorNode(u,{type:"sawtooth"}));a(this,p,u.createGain());this.duration=t,r(this,m).connect(r(this,p)),r(this,p).connect(u.destination)}setLoudness(t){r(this,p).gain.setValueAtTime(0,u.currentTime),r(this,p).gain.setValueAtTime(t,u.currentTime+ft),r(this,p).gain.setValueAtTime(0,u.currentTime+this.duration)}setFrequency(t){r(this,m).frequency.setValueAtTime(t,u.currentTime)}play(){r(this,m).start(),r(this,m).stop(u.currentTime+this.duration)}}m=new WeakMap,p=new WeakMap;const G=10;var M,w;class wt{constructor(t,e,s,n,h){o(this,"x");o(this,"y");o(this,"frequency");o(this,"color");o(this,"duration");a(this,M);a(this,w);o(this,"radius",0);o(this,"ripples",[this]);o(this,"heard",!1);this.x=t,this.y=e,this.duration=h,this.frequency=s,this.color=n,d(this,M,Date.now()),d(this,w,new pt(h/1e3))}update(t,e){this.ripples.forEach(s=>s.radius+=G),Date.now()-r(this,M)<this.duration&&this.ripples.push({x:t,y:e,radius:0,heard:!1}),window.eventBus.emit("soundUpdate",this)}play(){const t=Math.exp(-this.radius/500);r(this,w).setLoudness(t),r(this,w).setFrequency(this.frequency),r(this,w).play()}changeFrequency(t){const e=at(this.frequency,t,G);r(this,w).setFrequency(e)}draw(t){t.strokeStyle=this.color,this.ripples.forEach(({x:e,y:s,radius:n})=>{t.beginPath(),t.arc(e,s,Math.max(n,0),0,Math.TAU),t.stroke()})}}M=new WeakMap,w=new WeakMap;const gt={nee:700,naw:500},yt={nee:"Red",naw:"Blue"};var L,T,R,Z;class mt{constructor(t=1e3){a(this,R);o(this,"interval");o(this,"playing",!1);a(this,L,[]);a(this,T,0);this.interval=t}togglePlay(t=!this.playing){this.playing=t}update(t,e){r(this,L).forEach(s=>s.update(t,e)),l(this,R,Z).call(this,t,e)}draw(t){r(this,L).forEach(e=>e.draw(t))}}L=new WeakMap,T=new WeakMap,R=new WeakSet,Z=function(t,e){if(this.playing&&Date.now()-r(this,T)>this.interval){const s=r(this,L).length%2?"nee":"naw",n=gt[s],h=yt[s];r(this,L).push(new wt(t,e,n,h,this.interval)),d(this,T,Date.now())}};const Lt=""+new URL("ambulance-CEqcCkv5.png",import.meta.url).href;var b,B,_;class bt extends ut{constructor(e,s,n,h){super(e,s,n,h,Lt);a(this,B);a(this,b);d(this,b,new mt),l(this,B,_).call(this)}update(){super.update(),r(this,b).update(this.x,this.y)}draw(e){super.draw(e),r(this,b).draw(e)}}b=new WeakMap,B=new WeakSet,_=function(){document.addEventListener("keypress",e=>{e.key===" "&&r(this,b).togglePlay()})};var D,$;class At{constructor(t,e){a(this,D);o(this,"x");o(this,"y");this.x=t,this.y=e,l(this,D,$).call(this)}draw(t){t.beginPath(),t.font="50px Arial",t.textAlign="center",t.textBaseline="middle",t.fillText("🎙️",this.x,this.y)}}D=new WeakSet,$=function(){window.eventBus.on("soundUpdate",t=>{t.ripples.forEach((e,s,n)=>{if(e.heard)return;const h=H(this,e);if(h<=e.radius)if(e.heard=!0,e===t)t.play();else{const A=H(this,n[s-1]);h-A&&t.changeFrequency((A-h)/42)}})})};const vt=1.7,O=30,Ct=vt*O,U=.5*O,Mt=O+2*U,W=17,x=W*Mt+2*U,Tt=10**5,tt=Math.floor((W-1)/2);document.querySelector("#app").innerHTML=`
	<div id="road">
		<canvas id="road-canvas"></canvas>
	</div>
`;const C=document.querySelector("#road-canvas"),S=C.getContext("2d");et();const k=new dt(C.width/2,x,Tt,W,U),E=new bt(k.getLaneCenter(tt),0,O,Ct),kt=new At(k.getLaneCenter(tt),-400);it();Object.assign(window,{ambulance:E,road:k});function et(){C.width=x,C.height=window.innerHeight}function it(){et(),qt(),St(),requestAnimationFrame(it)}function qt(){[k,E].forEach(i=>i.update())}function St(){S.save(),S.translate(0,-E.y+C.height*.8),[k,kt,E].forEach(i=>i.draw(S)),S.restore()}
