var it=Object.defineProperty;var F=i=>{throw TypeError(i)};var st=(i,t,e)=>t in i?it(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var o=(i,t,e)=>st(i,typeof t!="symbol"?t+"":t,e),O=(i,t,e)=>t.has(i)||F("Cannot "+e);var r=(i,t,e)=>(O(i,t,"read from private field"),e?e.call(i):t.get(i)),a=(i,t,e)=>t.has(i)?F("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(i):t.set(i,e),c=(i,t,e,s)=>(O(i,t,"write to private field"),s?s.call(i,e):t.set(i,e),e),l=(i,t,e)=>(O(i,t,"access private method"),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const h of n)if(h.type==="childList")for(const C of h.addedNodes)C.tagName==="LINK"&&C.rel==="modulepreload"&&s(C)}).observe(document,{childList:!0,subtree:!0});function e(n){const h={};return n.integrity&&(h.integrity=n.integrity),n.referrerPolicy&&(h.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?h.credentials="include":n.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function s(n){if(n.ep)return;n.ep=!0;const h=e(n);fetch(n.href,h)}})();var d;class nt{constructor(){a(this,d,{})}on(t,e){var s;return(s=r(this,d))[t]??(s[t]=[]),r(this,d)[t].push(e),this}off(t,e){const s=r(this,d)[t];return r(this,d)[t]=e?s==null?void 0:s.filter(n=>n!==e):[],this}emit(t,...e){var s;return(s=r(this,d)[t])==null||s.forEach(n=>setTimeout(()=>n(...e))),this}destroy(){return c(this,d,{}),this}}d=new WeakMap;Math.TAU??(Math.TAU=2*Math.PI);window.eventBus=new nt;function v(i,t,e){i.fillStyle="green",i.fillRect(t-2/2,e-2/2,2,2)}function U(i,t,e){return i+(t-i)*e}function V(i,t,e){return Math.max(t,Math.min(i,e))}function I(i,t){return Math.hypot(i.x-t.x,i.y-t.y)}function rt(i,t){return i+Math.sign(i)*t}function ot(i,t){return{x:i*Math.cos(t),y:i*Math.sin(t)}}function ht(i,t,e){return i*e/(e-t)}const at=5;class dt{constructor(t,e,s,n){o(this,"laneCount");o(this,"laneWidth");o(this,"length");o(this,"margin");o(this,"width",0);o(this,"left",0);o(this,"right",0);o(this,"top",0);o(this,"bottom",0);this.laneCount=t,this.laneWidth=e,this.length=s,this.margin=n,this.updateSize()}update(){}updateSize(){this.width=this.laneCount*this.laneWidth+2*this.margin,this.left=this.margin,this.right=this.width-this.margin,this.top=-this.length/2,this.bottom=this.length/2}getLaneCenter(t){const e=(this.width-2*this.margin)/this.laneCount;return U(this.left,this.right,t/this.laneCount)+e/2}draw(t){t.save(),t.lineWidth=at,t.strokeStyle="White";for(let e=0;e<=this.laneCount;e++){const s=[0,this.laneCount].includes(e);t.setLineDash(s?[]:[30,60]);const n=U(this.left,this.right,e/this.laneCount);t.beginPath(),t.moveTo(n,this.top),t.lineTo(n,this.bottom),t.stroke(),v(t,n,0)}t.restore()}}var P,G;class ct{constructor(){a(this,P);o(this,"up",!1);o(this,"down",!1);o(this,"left",!1);o(this,"right",!1);l(this,P,G).call(this)}}P=new WeakSet,G=function(){document.addEventListener("keydown",t=>{switch(t.key){case"ArrowUp":this.up=!0;break;case"ArrowDown":this.down=!0;break;case"ArrowLeft":this.left=!0;break;case"ArrowRight":this.right=!0;break}}),document.addEventListener("keyup",t=>{switch(t.key){case"ArrowUp":this.up=!1;break;case"ArrowDown":this.down=!1;break;case"ArrowLeft":this.left=!1;break;case"ArrowRight":this.right=!1;break}})};const k=3.7,H=.17,K=.03,N=.05;var y,f,w,J,Q,X;class lt{constructor(t,e,s,n,h){a(this,w);o(this,"x");o(this,"y");o(this,"width");o(this,"length");o(this,"direction",-Math.TAU/4);o(this,"speed",0);a(this,y);a(this,f);this.x=t,this.y=e,this.width=s,this.length=n,c(this,f,new ct),h&&(c(this,y,new Image),r(this,y).src=h)}update(){l(this,w,J).call(this),l(this,w,Q).call(this),l(this,w,X).call(this)}draw(t){t.save(),t.translate(this.x,this.y),t.rotate(this.direction),r(this,y)?t.drawImage(r(this,y),-this.length/2,-this.width/2,this.length,this.width):(t.fillStyle="black",t.fillRect(-this.length/2,-this.width/2,this.length*(1-.17),this.width),t.fillStyle="red",t.fillRect(-this.length/2+this.length*(1-.17),-this.width/2,.17*this.length,this.width)),v(t,0,0),v(t,-this.length/2,-this.width/2),v(t,-this.length/2,this.width/2),v(t,this.length/2,-this.width/2),v(t,this.length/2,this.width/2),t.restore()}}y=new WeakMap,f=new WeakMap,w=new WeakSet,J=function(){r(this,f).up&&(this.speed=V(this.speed+H,-k,k)),r(this,f).down&&(this.speed=V(this.speed-H,-k,k)),this.speed=rt(this.speed,-N),Math.abs(this.speed)<N&&(this.speed=0)},Q=function(){r(this,f).left&&(this.direction-=Math.sign(this.speed)*K),r(this,f).right&&(this.direction+=Math.sign(this.speed)*K)},X=function(){const{x:t,y:e}=ot(this.speed,this.direction);this.x+=t,this.y+=e};const u=new AudioContext,ut=.1;var m,p;class ft{constructor(t){o(this,"duration");a(this,m,new OscillatorNode(u,{type:"sawtooth"}));a(this,p,u.createGain());this.duration=t,r(this,m).connect(r(this,p)),r(this,p).connect(u.destination)}setLoudness(t){r(this,p).gain.setValueAtTime(0,u.currentTime),r(this,p).gain.setValueAtTime(t,u.currentTime+ut),r(this,p).gain.setValueAtTime(0,u.currentTime+this.duration)}setFrequency(t){r(this,m).frequency.setValueAtTime(t,u.currentTime)}play(){r(this,m).start(),r(this,m).stop(u.currentTime+this.duration)}}m=new WeakMap,p=new WeakMap;const j=10;var T,g;class pt{constructor(t,e,s,n,h){o(this,"x");o(this,"y");o(this,"frequency");o(this,"color");o(this,"duration");a(this,T);a(this,g);o(this,"radius",0);o(this,"ripples",[this]);o(this,"heard",!1);this.x=t,this.y=e,this.duration=h,this.frequency=s,this.color=n,c(this,T,Date.now()),c(this,g,new ft(h/1e3))}update(t,e){this.ripples.forEach(s=>s.radius+=j),Date.now()-r(this,T)<this.duration&&this.ripples.push({x:t,y:e,radius:0,heard:!1}),window.eventBus.emit("soundUpdate",this)}play(){const t=Math.exp(-this.radius/500);r(this,g).setLoudness(t),r(this,g).setFrequency(this.frequency),r(this,g).play()}changeFrequency(t){const e=ht(this.frequency,t,j);r(this,g).setFrequency(e)}draw(t){t.strokeStyle=this.color,this.ripples.forEach(({x:e,y:s,radius:n})=>{t.beginPath(),t.arc(e,s,Math.max(n,0),0,Math.TAU),t.stroke()})}}T=new WeakMap,g=new WeakMap;const gt={nee:700,naw:500},wt={nee:"Red",naw:"Blue"};var L,S,R,Y;class yt{constructor(t=1e3){a(this,R);o(this,"interval");o(this,"playing",!1);a(this,L,[]);a(this,S,0);this.interval=t}togglePlay(t=!this.playing){this.playing=t}update(t,e){r(this,L).forEach(s=>s.update(t,e)),l(this,R,Y).call(this,t,e)}draw(t){r(this,L).forEach(e=>e.draw(t))}}L=new WeakMap,S=new WeakMap,R=new WeakSet,Y=function(t,e){if(this.playing&&Date.now()-r(this,S)>this.interval){const s=r(this,L).length%2?"nee":"naw",n=gt[s],h=wt[s];r(this,L).push(new pt(t,e,n,h,this.interval)),c(this,S,Date.now())}};const mt=""+new URL("ambulance-CEqcCkv5.png",import.meta.url).href;var b,B,Z;class Lt extends lt{constructor(e,s,n,h){super(e,s,n,h,mt);a(this,B);a(this,b);c(this,b,new yt),l(this,B,Z).call(this)}update(){super.update(),r(this,b).update(this.x,this.y)}draw(e){super.draw(e),r(this,b).draw(e)}}b=new WeakMap,B=new WeakSet,Z=function(){document.addEventListener("keypress",e=>{e.key===" "&&r(this,b).togglePlay()})};var D,_;class bt{constructor(t,e){a(this,D);o(this,"x");o(this,"y");this.x=t,this.y=e,l(this,D,_).call(this)}draw(t){t.beginPath(),t.font="50px Arial",t.textAlign="center",t.textBaseline="middle",t.fillText("🎙️",this.x,this.y)}}D=new WeakSet,_=function(){window.eventBus.on("soundUpdate",t=>{t.ripples.forEach((e,s,n)=>{if(e.heard)return;const h=I(this,e);if(h<=e.radius)if(e.heard=!0,e===t)t.play();else{const C=I(this,n[s-1]);h-C&&t.changeFrequency((C-h)/42)}})})};const At=1.7,W=30,Ct=At*W,$=.5*W,x=17,vt=W+2*$,Mt=10**5,tt=Math.floor((x-1)/2);document.querySelector("#app").innerHTML=`
	<div id="road">
		<canvas id="road-canvas"></canvas>
	</div>
`;const E=document.querySelector("#road-canvas"),q=E.getContext("2d"),A=new dt(x,vt,Mt,$),M=new Lt(A.getLaneCenter(tt),0,W,Ct),z=new bt(A.getLaneCenter(tt),-400);et();Object.assign(window,{road:A,ambulance:M,microphone:z});console.log({road:A,ambulance:M,microphone:z});function Tt(){E.width=A.width,E.height=window.innerHeight}function et(){Tt(),St(),kt(),requestAnimationFrame(et)}function St(){[A,M].forEach(i=>i.update())}function kt(){q.save(),q.translate(0,-M.y+E.height*.8),[A,z,M].forEach(i=>i.draw(q)),q.restore()}
