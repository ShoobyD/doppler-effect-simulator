var it=Object.defineProperty;var U=i=>{throw TypeError(i)};var st=(i,t,e)=>t in i?it(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var o=(i,t,e)=>st(i,typeof t!="symbol"?t+"":t,e),O=(i,t,e)=>t.has(i)||U("Cannot "+e);var r=(i,t,e)=>(O(i,t,"read from private field"),e?e.call(i):t.get(i)),h=(i,t,e)=>t.has(i)?U("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(i):t.set(i,e),c=(i,t,e,s)=>(O(i,t,"write to private field"),s?s.call(i,e):t.set(i,e),e),p=(i,t,e)=>(O(i,t,"access private method"),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const u of a.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&s(u)}).observe(document,{childList:!0,subtree:!0});function e(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(n){if(n.ep)return;n.ep=!0;const a=e(n);fetch(n.href,a)}})();var l;class nt{constructor(){h(this,l,{})}on(t,e){var s;return(s=r(this,l))[t]??(s[t]=[]),r(this,l)[t].push(e),this}off(t,e){const s=r(this,l)[t];return r(this,l)[t]=e?s==null?void 0:s.filter(n=>n!==e):[],this}emit(t,...e){var s;return(s=r(this,l)[t])==null||s.forEach(n=>setTimeout(()=>n(...e))),this}destroy(){return c(this,l,{}),this}}l=new WeakMap;Math.TAU??(Math.TAU=2*Math.PI);window.eventBus=new nt;function S(i,t,e){i.fillStyle="green",i.fillRect(t-2/2,e-2/2,2,2)}function V(i,t,e){return i+(t-i)*e}function I(i,t,e){return Math.max(t,Math.min(i,e))}function H(i,t){return Math.hypot(i.x-t.x,i.y-t.y)}function rt(i,t){return i+Math.sign(i)*t}function ot(i,t){return{x:i*Math.cos(t),y:i*Math.sin(t)}}function at(i,t,e){return i*e/(e-t)}const ht=5;class lt{constructor(t,e,s,n){o(this,"laneCount");o(this,"laneWidth");o(this,"length");o(this,"margin");o(this,"width",0);o(this,"left",0);o(this,"right",0);o(this,"top",0);o(this,"bottom",0);this.laneCount=t,this.laneWidth=e,this.length=s,this.margin=n,this.updateSize()}update(){}setLaneCount(t){this.laneCount=t,this.updateSize()}updateSize(){this.width=this.laneCount*this.laneWidth+2*this.margin,this.left=this.margin,this.right=this.width-this.margin,this.top=-this.length/2,this.bottom=this.length/2}getLaneCenter(t){const e=(this.width-2*this.margin)/this.laneCount;return V(this.left,this.right,t/this.laneCount)+e/2}draw(t){t.save(),t.lineWidth=ht,t.strokeStyle="White";for(let e=0;e<=this.laneCount;e++){const s=[0,this.laneCount].includes(e);t.setLineDash(s?[]:[30,60]);const n=V(this.left,this.right,e/this.laneCount);t.beginPath(),t.moveTo(n,this.top),t.lineTo(n,this.bottom),t.stroke(),S(t,n,0)}t.restore()}}var P,G;class dt{constructor(){h(this,P);o(this,"up",!1);o(this,"down",!1);o(this,"left",!1);o(this,"right",!1);p(this,P,G).call(this)}}P=new WeakSet,G=function(){document.addEventListener("keydown",t=>{switch(t.key){case"ArrowUp":this.up=!0;break;case"ArrowDown":this.down=!0;break;case"ArrowLeft":this.left=!0;break;case"ArrowRight":this.right=!0;break}}),document.addEventListener("keyup",t=>{switch(t.key){case"ArrowUp":this.up=!1;break;case"ArrowDown":this.down=!1;break;case"ArrowLeft":this.left=!1;break;case"ArrowRight":this.right=!1;break}})};const q=3.7,K=.17,N=.03,j=.05;var v,g,y,$,J,Q;class ut{constructor(t,e,s,n,a){h(this,y);o(this,"x");o(this,"y");o(this,"width");o(this,"length");o(this,"direction",-Math.TAU/4);o(this,"speed",0);h(this,v);h(this,g);this.x=t,this.y=e,this.width=s,this.length=n,c(this,g,new dt),a&&(c(this,v,new Image),r(this,v).src=a)}update(){p(this,y,$).call(this),p(this,y,J).call(this),p(this,y,Q).call(this)}draw(t){t.save(),t.translate(this.x,this.y),t.rotate(this.direction),r(this,v)?t.drawImage(r(this,v),-this.length/2,-this.width/2,this.length,this.width):(t.fillStyle="black",t.fillRect(-this.length/2,-this.width/2,this.length*(1-.17),this.width),t.fillStyle="red",t.fillRect(-this.length/2+this.length*(1-.17),-this.width/2,.17*this.length,this.width)),S(t,0,0),S(t,-this.length/2,-this.width/2),S(t,-this.length/2,this.width/2),S(t,this.length/2,-this.width/2),S(t,this.length/2,this.width/2),t.restore()}}v=new WeakMap,g=new WeakMap,y=new WeakSet,$=function(){r(this,g).up&&(this.speed=I(this.speed+K,-q,q)),r(this,g).down&&(this.speed=I(this.speed-K,-q,q)),this.speed=rt(this.speed,-j),Math.abs(this.speed)<j&&(this.speed=0)},J=function(){r(this,g).left&&(this.direction-=Math.sign(this.speed)*N),r(this,g).right&&(this.direction+=Math.sign(this.speed)*N)},Q=function(){const{x:t,y:e}=ot(this.speed,this.direction);this.x+=t,this.y+=e};const f=new AudioContext,ct=.1;var b,w;class pt{constructor(t){o(this,"duration");h(this,b,new OscillatorNode(f,{type:"sawtooth"}));h(this,w,f.createGain());this.duration=t,r(this,b).connect(r(this,w)),r(this,w).connect(f.destination)}setLoudness(t){r(this,w).gain.setValueAtTime(0,f.currentTime),r(this,w).gain.setValueAtTime(t,f.currentTime+ct),r(this,w).gain.setValueAtTime(0,f.currentTime+this.duration)}setFrequency(t){r(this,b).frequency.setValueAtTime(t,f.currentTime)}play(){r(this,b).start(),r(this,b).stop(f.currentTime+this.duration)}}b=new WeakMap,w=new WeakMap;const x=10;var A,m;class ft{constructor(t,e,s,n,a){o(this,"x");o(this,"y");o(this,"frequency");o(this,"color");o(this,"duration");h(this,A);h(this,m);o(this,"radius",0);o(this,"ripples",[this]);o(this,"heard",!1);this.x=t,this.y=e,this.duration=a,this.frequency=s,this.color=n,c(this,A,Date.now()),c(this,m,new pt(a/1e3))}update(t,e){this.ripples.forEach(s=>s.radius+=x),Date.now()-r(this,A)<this.duration&&this.ripples.push({x:t,y:e,radius:0,heard:!1}),window.eventBus.emit("soundUpdate",this)}play(){const t=Math.exp(-this.radius/500);r(this,m).setLoudness(t),r(this,m).setFrequency(this.frequency),r(this,m).play()}changeFrequency(t){const e=at(this.frequency,t,x);r(this,m).setFrequency(e)}draw(t){t.strokeStyle=this.color,this.ripples.forEach(({x:e,y:s,radius:n})=>{t.beginPath(),t.arc(e,s,Math.max(n,0),0,Math.TAU),t.stroke()})}}A=new WeakMap,m=new WeakMap;const gt={nee:700,naw:500},wt={nee:"Red",naw:"Blue"};var L,M,R,X;class mt{constructor(t=1e3){h(this,R);o(this,"interval");o(this,"playing",!1);h(this,L,[]);h(this,M,0);this.interval=t}togglePlay(t=!this.playing){this.playing=t}update(t,e){r(this,L).forEach(s=>s.update(t,e)),p(this,R,X).call(this,t,e)}draw(t){r(this,L).forEach(e=>e.draw(t))}}L=new WeakMap,M=new WeakMap,R=new WeakSet,X=function(t,e){if(this.playing&&Date.now()-r(this,M)>this.interval){const s=r(this,L).length%2?"nee":"naw",n=gt[s],a=wt[s];r(this,L).push(new ft(t,e,n,a,this.interval)),c(this,M,Date.now())}};const yt=""+new URL("ambulance-CEqcCkv5.png",import.meta.url).href;var C,B,Y;class vt extends ut{constructor(e,s,n,a){super(e,s,n,a,yt);h(this,B);h(this,C);c(this,C,new mt),p(this,B,Y).call(this)}update(){super.update(),r(this,C).update(this.x,this.y)}draw(e){super.draw(e),r(this,C).draw(e)}}C=new WeakMap,B=new WeakSet,Y=function(){document.addEventListener("keypress",e=>{e.key===" "&&r(this,C).togglePlay()})};var D,Z;class bt{constructor(t,e){h(this,D);o(this,"x");o(this,"y");this.x=t,this.y=e,p(this,D,Z).call(this)}draw(t){t.beginPath(),t.font="50px Arial",t.textAlign="center",t.textBaseline="middle",t.fillText("ðŸŽ™ï¸",this.x,this.y)}}D=new WeakSet,Z=function(){window.eventBus.on("soundUpdate",t=>{t.ripples.forEach((e,s,n)=>{if(e.heard)return;const a=H(this,e);if(a<=e.radius)if(e.heard=!0,e===t)t.play();else{const u=H(this,n[s-1]);a-u&&t.changeFrequency((u-a)/42)}})})};const Lt=1.7,W=30,Ct=Lt*W,_=.5*W,F=17,St=W+2*_,Et=10**5,tt=Math.floor((F-1)/2);document.querySelector("#app").innerHTML=`
	<div id="controls-panel">
		<label id="lanes">
			<div class="label"># of lanes (<output></output>)</div>
			<input type="range" name="lanes" min="1" max="20">
		</label>
		<label id="speed">
			<div class="label">Max-Speed (<output></output>)</div>
			<input type="range" name="speed" min="3" max="10" step="0.1">
		</label>
	</div>
	<div id="road">
		<canvas id="road-canvas"></canvas>
	</div>
`;const At=document.querySelector("#controls-panel");Mt(At);const k=document.querySelector("#road-canvas"),T=k.getContext("2d"),d=new lt(F,St,Et,_),E=new vt(d.getLaneCenter(tt),0,W,Ct),z=new bt(d.getLaneCenter(tt),-400);et();Object.assign(window,{road:d,ambulance:E,microphone:z});console.log({road:d,ambulance:E,microphone:z});function Mt(i){[{name:"lanes",handler:t=>{d.setLaneCount(t);const e=Math.floor((t-1)/2),s=d.getLaneCenter(e);E.x=z.x=s},defaultValue:F},{name:"speed",handler:()=>{},defaultValue:4.7}].forEach(({name:t,handler:e,defaultValue:s})=>{const n=i.querySelector(`#${t}`),a=n.querySelector("input"),u=n.querySelector("output");a.addEventListener("input",()=>{u.value=a.value,e(+a.value)}),a.value=s.toString(),setTimeout(()=>a.dispatchEvent(new Event("input")))})}function qt(){k.width=d.width,k.height=window.innerHeight}function et(){qt(),Tt(),kt(),requestAnimationFrame(et)}function Tt(){[d,E].forEach(i=>i.update())}function kt(){T.save(),T.translate(0,-E.y+k.height*.8),[d,z,E].forEach(i=>i.draw(T)),T.restore()}
